---
title: "Exercise 1"
---

```{r setup, include=F}
  knitr::opts_chunk$set(collapse = TRUE, echo = FALSE, message = FALSE,warning = FALSE,
  fig.width = 4, fig.height = 3, comment = "#>")
  library(kableExtra)
  library(ggplot2)
```

# {.tabset}

## Background on Fishery {.tabset}

<b>Arctic sardine (<i>Pseudosardina arctica</i>)</b>

<br>
![](C:/Users/barretttj/Desktop/Workshop/sardine.png){width=20%}
<br>

The Arctic sardine is a fictional small pelagic species with a mean generation time of 5 years. It is a schooling fish that forms predictable aggregations for feeding, overwintering, and spawning. Suppose the Arctic sardine stock is divided in multiple management units (MUs) for the purposes of assessment and management (Figure 1):
<br>
•	MU1 (West spawning component)
<br>
•	MU2 (East offshore spawning component)
<br>
•	MU3 (East nearshore spawning component)
<br>
Each MU has several spawning areas and there is mixing of Arctic Sardine among the MUs during annual feeding and overwintering migrations. It is assumed that Arctic Sardine exhibit spawning-area fidelity such that during the spawning season, the fish are separated by MU. Acoustic surveys conducted on the spawning grounds therefore represent a measure of spawning stock biomass for the specific MU.
<br>
<br>


<b> Table 1. Description of Management Units </b>
<br>
<table border="1" cellpadding="0" cellspacing="" width="100%">
  <tr>
    <th>Management Unit</th>
    <th>Details</th>
  </tr>
  <tr>
    <td>1 (West spawning component)</td>
    <td>Largest component by landings (~90% for the stock)<br>
        3 spawning areas<br>
        Acoustic surveys in the 3 spawning areas<br>
        Gear types: purse seine (~80% of catches) and gill net<br>
        Purse seiners target spawning aggregations and summer feeding aggregations<br> </td>
  </tr><br>
  <tr>
    <td>2 (East offshore spawning component)</td>
    <td>Gear types: purse seine only<br>
        Fishing activity is limited due to distance<br>
        Specific spawning locations are unknown<br></td>
  </tr><br>
    <tr>
    <td>3 (East nearshore spawning component)</td>
    <td>Gear types: gill net only<br>
        2 spawning areas<br>
        Acoustic surveys in the 3 spawning areas<br></td>
  </tr>
</table>
<br>
<br>
<br>


![](C:/Users/barretttj/Desktop/Workshop/1b.png){width=100%}

<B>Figure 1. Map of the Arctic sardine management units (MU1, MU2, MU3).</B>
<br>
<i>Green polygons = known spawning areas and locations of acoustic surveys during the spawning season </i>

## Figures {.tabset}

### Entire Stock (MU1,2,3) {.tabset}

Consider the suitability of these potential indicators for Arctic sardine (pelagic forage fish) for the entire stock area:
<br><br>
•	Total biomass index for the groundfish bottom trawl survey (some coverage in MU1 and MU2 only)
<br>
•	Acoustic spawning stock biomass index on known spawning grounds (full coverage in MU1 and MU3, no coverage in MU2)
<br>
<br>

![](C:/Users/barretttj/Desktop/Workshop/1f.png){width=70%}
<br>
<B>Figure 2.1.1 Map of stock area (MU1, 2, and 3)</B>
<br>
<i>Notes:<i><br>
<I>Hatched area = groundfish bottom trawl survey coverage</I><br>
<I>green polygons = acoustic survey coverage on spawning grounds</I>
<br>
<br>
<br>

```{r}
library(ggplot2)
L <- read.csv("ex1_landings.csv")
D <- read.csv("ex1_indices.csv")
D$CPUE <- (D$PS_Catch_MU1)/D$PS_Effort
ggplot() + geom_area(data=L, mapping=aes(y=Landings_kt,x=Year,fill=MU)) +
  theme_classic() + labs(x='Year', y="Landings (kt)") +
  scale_x_continuous(limits = c(0,50), expand = c(0, 0)) +
  scale_y_continuous(limits = c(0,300), expand = c(0, 0)) +
  scale_fill_manual(values=c("lightskyblue2","plum3","lightgoldenrod"))
```
<br>
<B>Fig 2.1.2 Historical Landings by Management Unit (MU)</B>
<br>
<br>

```{r}
#MU1 and MU2 Bottom trawl survey
D$MA_1 <- NA
D$MA_1[11:50] <- apply(cbind(D$BT_Index_MU1_2[D$Year%in%11:50],
                                                  D$BT_Index_MU1_2[D$Year%in%10:49],
                                                  D$BT_Index_MU1_2[D$Year%in%9:48]),1,mean)

#Add loess smoother (example span = 0.5)
lsmooth1 <- loess(BT_Index_MU1_2 ~ Year,data=D,span=0.5)  
D$lowess1 <- NA
D$lowess1[D$Year%in%9:50] <- predict(lsmooth1)

ggplot(D[!is.na(D$BT_Index_MU1_2),]) + geom_path(mapping=aes(y=BT_Index_MU1_2,x=Year)) + theme_classic() + labs(x="Year", y="MU1 and MU2 Bottom Trawl Survey Index (kt)") + expand_limits(y=0,x=50) +
  scale_x_continuous(limits = c(0,50), expand = c(0, 0)) +
  geom_path(data=D[!is.na(D$MA_1),],mapping=aes(y=MA_1,x=Year),color="red") +
  geom_path(data=D[!is.na(D$lowess1),],mapping=aes(y=lowess1,x=Year),color="blue") 

```
<br>
<B>Fig 2.1.3 Biomass Index from the Groundfish Bottom Trawl Survey for MU1 and MU2</B>
<br>
<i> Notes: </i>
<i> Index is a relative index of total "benthic" biomass </i>
<i> Red line = 3 year moving average </i>
<i> Blue line = loess smoother with span = 0.5 </i>
<br>
<br>

```{r}
#MU1 and MU3 Acoustic survey
D$MA_2 <- NA
D$MA_2[28:50] <- apply(cbind(D$Ac_Index_MU1_3[D$Year%in%28:50],
                             D$Ac_Index_MU1_3[D$Year%in%27:49],
                             D$Ac_Index_MU1_3[D$Year%in%26:48]),1,mean)

#Add loess smoother (example span = 0.5)
lsmooth2 <- loess(Ac_Index_MU1_3 ~ Year,data=D,span=0.5)  
D$lowess2 <- NA
D$lowess2[D$Year%in%26:50] <- predict(lsmooth2)

ggplot(D[!is.na(D$Ac_Index_MU1_3),]) + geom_path(mapping=aes(y=Ac_Index_MU1_3,x=Year)) + theme_classic() + labs(x="Year", y="MU1 and MU3 Acoustic SSB Index (kt)") + expand_limits(y=0,x=50) +
  scale_x_continuous(limits = c(0,50), expand = c(0, 0)) +
  geom_path(data=D[!is.na(D$MA_2),],mapping=aes(y=MA_2,x=Year),color="red") +
  geom_path(data=D[!is.na(D$lowess2),],mapping=aes(y=lowess2,x=Year),color="blue") 

```
<br>
<B>Fig 2.1.4 Spawning Stock Biomass Index from acoustic surveys on the spawning grounds for MU1 and MU3</B>
<br>
<i> Notes: </i>
<i> Index is a relative index of SSB </i>
<i> Black line = Annual index </i><br>
<i> Red line = 3 year moving average </i>
<i> Blue line = loess smoother with span = 0.5 </i>
<br>
<br>


### MU1{.tabset}

Consider the suitability of these potential indicators for Arctic sardine (pelagic forage fish) in MU1:
<br><br>
•	Total catch, CPUE for purse seine fleet (~80% of catches)
<br>
•	Total biomass index for the groundfish bottom trawl survey (some coverage in MU1)
<br>
•	Acoustic spawning stock biomass index on known spawning grounds (full coverage in MU1)
<br>
<br>

![](C:/Users/barretttj/Desktop/Workshop/1g.png){width=70%}
<br>
<B>Figure 2.2.1 Map of MU1</B>
<br>
<i>Notes:<i><br>
<I>Hatched area = groundfish bottom trawl survey coverage</I><br>
<I>green polygons = acoustic survey coverage on spawning grounds</I>
<br>
<br>

```{r}
ggplot(D[!(is.na(D$PS_Catch_MU1)),],aes(y=PS_Catch_MU1,x=Year)) + geom_path() +
    scale_x_continuous(limits = c(0,50), expand = c(0, 0)) +
    theme_classic() + labs(x='Year', y="MU1 Purse Seine Landings (kt)") + expand_limits(y=0)

```
<br>
<B>Figure 2.2.2 Landings for Purse Seine Fleet in MU1</B>
<br>
<br>

```{r}
ggplot(D[!(is.na(D$PS_Effort_MU1)),],aes(y=PS_Effort_MU1,x=Year)) + geom_path() +
    scale_x_continuous(limits = c(0,50), expand = c(0, 0)) +
    theme_classic() + labs(x='Year', y="MU1 Purse Seine Effort (trips)") + expand_limits(y=0)

```
<br>
<B>Figure 2.2.3 Total Effort for Purse Seine Fleet in MU1</B>
<br>
<br>

```{r}
ggplot(D[!(is.na(D$CPUE)),],aes(y=CPUE,x=Year)) + geom_path() +
    scale_x_continuous(limits = c(0,50), expand = c(0, 0)) +
    theme_classic() + labs(x='Year', y="MU1 Purse Seine CPUE (kt/trip)") + expand_limits(y=0)
```
<br>
<B>Figure 2.2.4 CPUE for Purse Seine Fleet in MU1</B>
<br>
<br>

```{r}
#MU1 Bottom trawl survey
D$MA_3 <- NA
D$MA_3[11:50] <- apply(cbind(D$BT_Index_MU1[D$Year%in%11:50],
                                                  D$BT_Index_MU1[D$Year%in%10:49],
                                                  D$BT_Index_MU1[D$Year%in%9:48]),1,mean)

#Add loess smoother (example span = 0.5)
lsmooth3 <- loess(BT_Index_MU1 ~ Year,data=D,span=0.5)  
D$lowess3 <- NA
D$lowess3[D$Year%in%9:50] <- predict(lsmooth3)

ggplot(D[!is.na(D$BT_Index_MU1),]) + geom_path(mapping=aes(y=BT_Index_MU1,x=Year)) + theme_classic() + labs(x="Year", y="MU1 Bottom Trawl Survey Index (kt)") + expand_limits(y=0,x=50) +
    scale_x_continuous(limits = c(0,50), expand = c(0, 0)) +
    geom_path(data=D[!is.na(D$MA_3),],mapping=aes(y=MA_3,x=Year),color="red") +
  geom_path(data=D[!is.na(D$lowess3),],mapping=aes(y=lowess3,x=Year),color="blue") 
```
<br>
<B>Figure 2.2.5 Biomass Index from the Groundfish Bottom Trawl Survey for MU1</B>
<br>
<i> Notes: </i><br>
<i> Index is a relative index of total "benthic" biomass </i><br>
<i> Red line = 3 year moving average </i><br>
<i> Blue line = loess smoother with span = 0.5 </i>
<br>
<br>


```{r}
#MU1 acoustic survey
D$MA_4 <- NA
D$MA_4[28:50] <- apply(cbind(D$Ac_Index_MU1[D$Year%in%28:50],
                                                  D$Ac_Index_MU1[D$Year%in%27:49],
                                                  D$Ac_Index_MU1[D$Year%in%26:48]),1,mean)

#Add loess smoother (example span = 0.5)
lsmooth4 <- loess(Ac_Index_MU1 ~ Year,data=D,span=0.5)  
D$lowess4 <- NA
D$lowess4[D$Year%in%26:50] <- predict(lsmooth4)

ggplot(D[!is.na(D$Ac_Index_MU1),]) + geom_path(mapping=aes(y=Ac_Index_MU1,x=Year)) + theme_classic() + labs(x="Year", y="MU1 Acoustic Index of SSB (kt)") + expand_limits(y=0,x=50) +
    scale_x_continuous(limits = c(0,50), expand = c(0, 0)) +
    geom_path(data=D[!is.na(D$MA_4),],mapping=aes(y=MA_4,x=Year),color="red") +
  geom_path(data=D[!is.na(D$lowess4),],mapping=aes(y=lowess4,x=Year),color="blue") 
  
```  
<br>
<B>Figure 2.2.6 Spawning Stock Biomass Index from acoustic surveys on the 3 spawning grounds for MU1</B>
<br>
<i> Notes: </i><br>
<i> Index is a relative index of SSB </i><br>
<i> Red line = 3 year moving average </i><br>
<i> Blue line = loess smoother with span = 0.5 </i>
<br>
<br>
